"use strict";

/* global ReactDnD */
/* eslint react/prop-types:0 */
var DragSource = ReactDnD.DragSource,
    DropTarget = ReactDnD.DropTarget,
    shapeColorMap = {
  W: { shape: "circle", color: "blue" },
  w: { shape: "circle", color: "lightskyblue" },
  T: { shape: "square", color: "forestgreen" },
  Tk: { shape: "square", color: "limegreen" },
  t: { shape: "square", color: "mediumspringgreen" }
},
    ItemTypes = {
  ALLELE: 'allele'
},
    alleleSource = {
  beginDrag: function beginDrag(props) {
    return { index: props.index, org: props.org, shape: shapeColorMap[props.allele].shape };
  }
},
    collectSource = function collectSource(connect, monitor) {
  return {
    connectDragSource: connect.dragSource(),
    isDragging: monitor.isDragging()
  };
},
    WrappedAllele = React.createClass({
  displayName: "WrappedAllele",

  render: function render() {
    var connectDragSource = this.props.connectDragSource,
        isDragging = this.props.isDragging,
        allele = this.props.allele;
    return connectDragSource(React.createElement('div', {}, !isDragging ? React.createElement(GeniBlocks.AlleleView, { allele: allele, color: shapeColorMap[allele].color, shape: shapeColorMap[allele].shape }) : null));
  }
}),
    DraggableAllele = DragSource(ItemTypes.ALLELE, alleleSource, collectSource)(WrappedAllele),
    alleleTarget = {
  drop: function drop(props, monitor) {
    props.moveAllele(monitor.getItem().index, monitor.getItem().org, props.index, props.org);
  },
  canDrop: function canDrop(props, monitor) {
    //console.log("can drop??");
    //console.log(monitor.getItem());
    //console.log(props);
    return monitor.getItem().shape === props.shape;
  }
},
    collectTarget = function collectTarget(connect, monitor) {
  return {
    connectDropTarget: connect.dropTarget(),
    isOver: monitor.isOver(),
    canDrop: monitor.canDrop()
  };
},
    WrappedAlleleTarget = React.createClass({
  displayName: "WrappedAlleleTarget",

  render: function render() {
    var connectDropTarget = this.props.connectDropTarget,
        isOver = this.props.isOver,
        canDrop = this.props.canDrop,
        shape = this.props.shape,
        allele = this.props.allele;
    return connectDropTarget(React.createElement('div', {}, React.createElement(GeniBlocks.AlleleView, { allele: allele, color: allele ? shapeColorMap[allele].color : null, shape: allele ? shapeColorMap[allele].shape : shape, target: true, hovering: isOver && canDrop })));
  }
}),
    AlleleDropTarget = DropTarget(ItemTypes.ALLELE, alleleTarget, collectTarget)(WrappedAlleleTarget),
    AlleleContainer = React.createClass({
  displayName: "AlleleContainer",

  render: function render() {
    var allelePool = this.props.pool,
        alleleTargets = this.props.targets,
        org = this.props.org,
        moveAllele = this.props.moveAllele;

    var pool = allelePool.map(function (allele, i) {
      if (!allele) return null;
      return React.createElement(DraggableAllele, { allele: allele, key: i, index: i, org: org });
    });

    var targets = alleleTargets.map(function (allele, i) {
      if (allele === "circle" || allele === "square") {
        var shape = allele;
        allele = null;
      } else {
        shape = shapeColorMap[allele].shape;
      }
      return React.createElement(AlleleDropTarget, { allele: allele, key: i, shape: shape, index: i, org: org, moveAllele: moveAllele });
    });

    return React.createElement('div', { className: "allele-container" }, React.createElement('div', { className: "allele-targets labelable" }, targets), React.createElement('div', { className: "allele-pool" }, pool));
  }
}),
    PunnettContainer = React.createClass({
  displayName: "PunnettContainer",

  render: function render() {
    var alleles = this.props.alleles,
        orgs = this.props.orgs,
        moveAllele = this.props.moveAllele,
        orgViews = orgs.map(function (org, index) {
      return org ? React.createElement(GeniBlocks.OrganismView, { org: org, key: index }) : null;
    });

    return React.createElement('div', { className: "punnett-square" }, React.createElement('div', { className: "top" }, React.createElement(AlleleDropTarget, { allele: alleles[0], shape: "circle", index: 0, moveAllele: moveAllele }), React.createElement(AlleleDropTarget, { allele: alleles[1], shape: "circle", index: 1, moveAllele: moveAllele })), React.createElement('div', { className: "row" }, React.createElement(AlleleDropTarget, { allele: alleles[2], shape: "circle", index: 2, moveAllele: moveAllele }), React.createElement('div', { className: "box org-1" }, orgViews[0]), React.createElement('div', { className: "box org-2" }, orgViews[2])), React.createElement('div', { className: "row" }, React.createElement(AlleleDropTarget, { allele: alleles[3], shape: "circle", index: 3, moveAllele: moveAllele }), React.createElement('div', { className: "box org-3" }, orgViews[1]), React.createElement('div', { className: "box org-4" }, orgViews[3])));
  }
});

window.AlleleContainer = AlleleContainer;
window.PunnettContainer = PunnettContainer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV4cGVyaW1lbnRzL2RyYWdnYWJsZS1hbGxlbGVzL2RyYWdnYWJsZS12aWV3cy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBRUEsSUFBSSxhQUFhLFNBQVMsVUFBVDtJQUNiLGFBQWEsU0FBUyxVQUFUO0lBRWIsZ0JBQWdCO0FBQ2QsS0FBSSxFQUFDLE9BQU8sUUFBUCxFQUFpQixPQUFPLE1BQVAsRUFBdEI7QUFDQSxLQUFJLEVBQUMsT0FBTyxRQUFQLEVBQWlCLE9BQU8sY0FBUCxFQUF0QjtBQUNBLEtBQUksRUFBQyxPQUFPLFFBQVAsRUFBaUIsT0FBTyxhQUFQLEVBQXRCO0FBQ0EsTUFBSSxFQUFDLE9BQU8sUUFBUCxFQUFpQixPQUFPLFdBQVAsRUFBdEI7QUFDQSxLQUFJLEVBQUMsT0FBTyxRQUFQLEVBQWlCLE9BQU8sbUJBQVAsRUFBdEI7Q0FMRjtJQVFBLFlBQVk7QUFDVixVQUFRLFFBQVI7Q0FERjtJQUlBLGVBQWU7QUFDYixhQUFXLG1CQUFVLEtBQVYsRUFBaUI7QUFDMUIsV0FBTyxFQUFDLE9BQU8sTUFBTSxLQUFOLEVBQWEsS0FBSyxNQUFNLEdBQU4sRUFBVyxPQUFPLGNBQWMsTUFBTSxNQUFOLENBQWQsQ0FBNEIsS0FBNUIsRUFBbkQsQ0FEMEI7R0FBakI7Q0FEYjtJQU1BLGdCQUFnQixTQUFoQixhQUFnQixDQUFTLE9BQVQsRUFBa0IsT0FBbEIsRUFBMkI7QUFDekMsU0FBTztBQUNMLHVCQUFtQixRQUFRLFVBQVIsRUFBbkI7QUFDQSxnQkFBWSxRQUFRLFVBQVIsRUFBWjtHQUZGLENBRHlDO0NBQTNCO0lBT2hCLGdCQUFnQixNQUFNLFdBQU4sQ0FBa0I7OztBQUNoQyxVQUFRLGtCQUFZO0FBQ2xCLFFBQUksb0JBQW9CLEtBQUssS0FBTCxDQUFXLGlCQUFYO1FBQ3BCLGFBQWEsS0FBSyxLQUFMLENBQVcsVUFBWDtRQUNiLFNBQVMsS0FBSyxLQUFMLENBQVcsTUFBWCxDQUhLO0FBSWxCLFdBQU8sa0JBQ0wsTUFBTSxhQUFOLENB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VyxXQUFYLEVBQTVCLEVBQXFELFNBQVMsQ0FBVCxDQUFyRCxDQUhGLENBVkYsQ0FERixDQVRrQjtHQUFaO0NBRFMsQ0FBbkI7O0FBK0JKLE9BQU8sZUFBUCxHQUF5QixlQUF6QjtBQUNBLE9BQU8sZ0JBQVAsR0FBMEIsZ0JBQTFCIiwiZmlsZSI6ImV4cGVyaW1lbnRzL2RyYWdnYWJsZS1hbGxlbGVzL2RyYWdnYWJsZS12aWV3cy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbCBSZWFjdERuRCAqL1xuLyogZXNsaW50IHJlYWN0L3Byb3AtdHlwZXM6MCAqL1xudmFyIERyYWdTb3VyY2UgPSBSZWFjdERuRC5EcmFnU291cmNlLFxuICAgIERyb3BUYXJnZXQgPSBSZWFjdERuRC5Ecm9wVGFyZ2V0LFxuXG4gICAgc2hhcGVDb2xvck1hcCA9IHtcbiAgICAgIFc6ICB7c2hhcGU6IFwiY2lyY2xlXCIsIGNvbG9yOiBcImJsdWVcIn0sXG4gICAgICB3OiAge3NoYXBlOiBcImNpcmNsZVwiLCBjb2xvcjogXCJsaWdodHNreWJsdWVcIn0sXG4gICAgICBUOiAge3NoYXBlOiBcInNxdWFyZVwiLCBjb2xvcjogXCJmb3Jlc3RncmVlblwifSxcbiAgICAgIFRrOiB7c2hhcGU6IFwic3F1YXJlXCIsIGNvbG9yOiBcImxpbWVncmVlblwifSxcbiAgICAgIHQ6ICB7c2hhcGU6IFwic3F1YXJlXCIsIGNvbG9yOiBcIm1lZGl1bXNwcmluZ2dyZWVuXCJ9XG4gICAgfSxcblxuICAgIEl0ZW1UeXBlcyA9IHtcbiAgICAgIEFMTEVMRTogJ2FsbGVsZSdcbiAgICB9LFxuXG4gICAgYWxsZWxlU291cmNlID0ge1xuICAgICAgYmVnaW5EcmFnOiBmdW5jdGlvbiAocHJvcHMpIHtcbiAgICAgICAgcmV0dXJuIHtpbmRleDogcHJvcHMuaW5kZXgsIG9yZzogcHJvcHMub3JnLCBzaGFwZTogc2hhcGVDb2xvck1hcFtwcm9wcy5hbGxlbGVdLnNoYXBlfTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgY29sbGVjdFNvdXJjZSA9IGZ1bmN0aW9uKGNvbm5lY3QsIG1vbml0b3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNvbm5lY3REcmFnU291cmNlOiBjb25uZWN0LmRyYWdTb3VyY2UoKSxcbiAgICAgICAgaXNEcmFnZ2luZzogbW9uaXRvci5pc0RyYWdnaW5nKClcbiAgICAgIH07XG4gICAgfSxcblxuICAgIFdyYXBwZWRBbGxlbGUgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGNvbm5lY3REcmFnU291cmNlID0gdGhpcy5wcm9wcy5jb25uZWN0RHJhZ1NvdXJjZSxcbiAgICAgICAgICAgIGlzRHJhZ2dpbmcgPSB0aGlzLnByb3BzLmlzRHJhZ2dpbmcsXG4gICAgICAgICAgICBhbGxlbGUgPSB0aGlzLnByb3BzLmFsbGVsZTtcbiAgICAgICAgcmV0dXJuIGNvbm5lY3REcmFnU291cmNlKFxuICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHt9LFxuICAgICAgICAgICAgIWlzRHJhZ2dpbmcgPyBSZWFjdC5jcmVhdGVFbGVtZW50KEdlbmlCbG9ja3MuQWxsZWxlVmlldywge2FsbGVsZTogYWxsZWxlLCBjb2xvcjogc2hhcGVDb2xvck1hcFthbGxlbGVdLmNvbG9yLCBzaGFwZTogc2hhcGVDb2xvck1hcFthbGxlbGVdLnNoYXBlfSkgOiBudWxsXG4gICAgICAgICAgKVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0pLFxuXG4gICAgRHJhZ2dhYmxlQWxsZWxlID0gRHJhZ1NvdXJjZShJdGVtVHlwZXMuQUxMRUxFLCBhbGxlbGVTb3VyY2UsIGNvbGxlY3RTb3VyY2UpKFdyYXBwZWRBbGxlbGUpLFxuXG4gICAgYWxsZWxlVGFyZ2V0ID0ge1xuICAgICAgZHJvcDogZnVuY3Rpb24gKHByb3BzLCBtb25pdG9yKSB7XG4gICAgICAgIHByb3BzLm1vdmVBbGxlbGUobW9uaXRvci5nZXRJdGVtKCkuaW5kZXgsIG1vbml0b3IuZ2V0SXRlbSgpLm9yZywgcHJvcHMuaW5kZXgsIHByb3BzLm9yZyk7XG4gICAgICB9LFxuICAgICAgY2FuRHJvcDogZnVuY3Rpb24gKHByb3BzLCBtb25pdG9yKSB7XG4gICAgICAgIC8vY29uc29sZS5sb2coXCJjYW4gZHJvcD8/XCIpO1xuICAgICAgICAvL2NvbnNvbGUubG9nKG1vbml0b3IuZ2V0SXRlbSgpKTtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhwcm9wcyk7XG4gICAgICAgIHJldHVybiAobW9uaXRvci5nZXRJdGVtKCkuc2hhcGUgPT09IHByb3BzLnNoYXBlKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgY29sbGVjdFRhcmdldCA9IGZ1bmN0aW9uKGNvbm5lY3QsIG1vbml0b3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNvbm5lY3REcm9wVGFyZ2V0OiBjb25uZWN0LmRyb3BUYXJnZXQoKSxcbiAgICAgICAgaXNPdmVyOiBtb25pdG9yLmlzT3ZlcigpLFxuICAgICAgICBjYW5Ecm9wOiBtb25pdG9yLmNhbkRyb3AoKVxuICAgICAgfTtcbiAgICB9LFxuXG4gICAgV3JhcHBlZEFsbGVsZVRhcmdldCA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY29ubmVjdERyb3BUYXJnZXQgPSB0aGlzLnByb3BzLmNvbm5lY3REcm9wVGFyZ2V0LFxuICAgICAgICAgICAgaXNPdmVyID0gdGhpcy5wcm9wcy5pc092ZXIsXG4gICAgICAgICAgICBjYW5Ecm9wID0gdGhpcy5wcm9wcy5jYW5Ecm9wLFxuICAgICAgICAgICAgc2hhcGUgPSB0aGlzLnByb3BzLnNoYXBlLFxuICAgICAgICAgICAgYWxsZWxlID0gdGhpcy5wcm9wcy5hbGxlbGU7XG4gICAgICAgIHJldHVybiBjb25uZWN0RHJvcFRhcmdldChcbiAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7fSxcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoR2VuaUJsb2Nrcy5BbGxlbGVWaWV3LCB7YWxsZWxlOiBhbGxlbGUsIGNvbG9yOiAoYWxsZWxlID8gc2hhcGVDb2xvck1hcFthbGxlbGVdLmNvbG9yIDogbnVsbCksIHNoYXBlOiAoYWxsZWxlID8gc2hhcGVDb2xvck1hcFthbGxlbGVdLnNoYXBlIDogc2hhcGUpLCB0YXJnZXQ6IHRydWUsIGhvdmVyaW5nOiAoaXNPdmVyICYmIGNhbkRyb3ApfSlcbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSksXG5cbiAgICBBbGxlbGVEcm9wVGFyZ2V0ID0gRHJvcFRhcmdldChJdGVtVHlwZXMuQUxMRUxFLCBhbGxlbGVUYXJnZXQsIGNvbGxlY3RUYXJnZXQpKFdyYXBwZWRBbGxlbGVUYXJnZXQpLFxuXG4gICAgQWxsZWxlQ29udGFpbmVyID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhbGxlbGVQb29sID0gdGhpcy5wcm9wcy5wb29sLFxuICAgICAgICAgICAgYWxsZWxlVGFyZ2V0cyA9IHRoaXMucHJvcHMudGFyZ2V0cyxcbiAgICAgICAgICAgIG9yZyA9IHRoaXMucHJvcHMub3JnLFxuICAgICAgICAgICAgbW92ZUFsbGVsZSA9IHRoaXMucHJvcHMubW92ZUFsbGVsZTtcblxuICAgICAgICB2YXIgcG9vbCA9IGFsbGVsZVBvb2wubWFwKGZ1bmN0aW9uKGFsbGVsZSwgaSkge1xuICAgICAgICAgIGlmICghYWxsZWxlKSByZXR1cm4gbnVsbDtcbiAgICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChEcmFnZ2FibGVBbGxlbGUsIHthbGxlbGU6IGFsbGVsZSwga2V5OiBpLCBpbmRleDogaSwgb3JnOiBvcmd9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIHRhcmdldHMgPSBhbGxlbGVUYXJnZXRzLm1hcChmdW5jdGlvbihhbGxlbGUsIGkpIHtcbiAgICAgICAgICBpZiAoYWxsZWxlID09PSBcImNpcmNsZVwiIHx8IGFsbGVsZSA9PT0gXCJzcXVhcmVcIikge1xuICAgICAgICAgICAgdmFyIHNoYXBlID0gYWxsZWxlO1xuICAgICAgICAgICAgYWxsZWxlID0gbnVsbDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2hhcGUgPSBzaGFwZUNvbG9yTWFwW2FsbGVsZV0uc2hhcGU7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KEFsbGVsZURyb3BUYXJnZXQsIHthbGxlbGU6IGFsbGVsZSwga2V5OiBpLCBzaGFwZTogc2hhcGUsIGluZGV4OiBpLCBvcmc6IG9yZywgbW92ZUFsbGVsZTogbW92ZUFsbGVsZX0pO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtjbGFzc05hbWU6IFwiYWxsZWxlLWNvbnRhaW5lclwifSxcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtjbGFzc05hbWU6IFwiYWxsZWxlLXRhcmdldHMgbGFiZWxhYmxlXCJ9LFxuICAgICAgICAgICAgICB0YXJnZXRzXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2Jywge2NsYXNzTmFtZTogXCJhbGxlbGUtcG9vbFwifSxcbiAgICAgICAgICAgICAgcG9vbFxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9KSxcblxuICAgIFB1bm5ldHRDb250YWluZXIgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGFsbGVsZXMgPSB0aGlzLnByb3BzLmFsbGVsZXMsXG4gICAgICAgICAgICBvcmdzID0gdGhpcy5wcm9wcy5vcmdzLFxuICAgICAgICAgICAgbW92ZUFsbGVsZSA9IHRoaXMucHJvcHMubW92ZUFsbGVsZSxcblxuICAgICAgICAgICAgb3JnVmlld3MgPSBvcmdzLm1hcChmdW5jdGlvbihvcmcsIGluZGV4KSB7XG4gICAgICAgICAgICAgIHJldHVybiBvcmcgPyAgUmVhY3QuY3JlYXRlRWxlbWVudChHZW5pQmxvY2tzLk9yZ2FuaXNtVmlldywge29yZzogb3JnLCBrZXk6IGluZGV4fSkgOiBudWxsO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7Y2xhc3NOYW1lOiBcInB1bm5ldHQtc3F1YXJlXCJ9LFxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2Jywge2NsYXNzTmFtZTogXCJ0b3BcIn0sXG4gICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQWxsZWxlRHJvcFRhcmdldCwge2FsbGVsZTogYWxsZWxlc1swXSwgc2hhcGU6IFwiY2lyY2xlXCIsIGluZGV4OiAwLCBtb3ZlQWxsZWxlOiBtb3ZlQWxsZWxlfSksXG4gICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQWxsZWxlRHJvcFRhcmdldCwge2FsbGVsZTogYWxsZWxlc1sxXSwgc2hhcGU6IFwiY2lyY2xlXCIsIGluZGV4OiAxLCBtb3ZlQWxsZWxlOiBtb3ZlQWxsZWxlfSlcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7Y2xhc3NOYW1lOiBcInJvd1wifSxcbiAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChBbGxlbGVEcm9wVGFyZ2V0LCB7YWxsZWxlOiBhbGxlbGVzWzJdLCBzaGFwZTogXCJjaXJjbGVcIiwgaW5kZXg6IDIsIG1vdmVBbGxlbGU6IG1vdmVBbGxlbGV9KSxcbiAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2Jywge2NsYXNzTmFtZTogXCJib3ggb3JnLTFcIn0sIG9yZ1ZpZXdzWzBdKSxcbiAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2Jywge2NsYXNzTmFtZTogXCJib3ggb3JnLTJcIn0sIG9yZ1ZpZXdzWzJdKVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHtjbGFzc05hbWU6IFwicm93XCJ9LFxuICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KEFsbGVsZURyb3BUYXJnZXQsIHthbGxlbGU6IGFsbGVsZXNbM10sIHNoYXBlOiBcImNpcmNsZVwiLCBpbmRleDogMywgbW92ZUFsbGVsZTogbW92ZUFsbGVsZX0pLFxuICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7Y2xhc3NOYW1lOiBcImJveCBvcmctM1wifSwgb3JnVmlld3NbMV0pLFxuICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7Y2xhc3NOYW1lOiBcImJveCBvcmctNFwifSwgb3JnVmlld3NbM10pXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0pO1xuXG53aW5kb3cuQWxsZWxlQ29udGFpbmVyID0gQWxsZWxlQ29udGFpbmVyO1xud2luZG93LlB1bm5ldHRDb250YWluZXIgPSBQdW5uZXR0Q29udGFpbmVyO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
