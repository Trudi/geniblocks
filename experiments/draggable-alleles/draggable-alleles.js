"use strict";

var DragDropContext = ReactDnD.DragDropContext,
    Backend = ReactDnDHTML5Backend,
    layoutAsLabels = false,
    dragons = [null, null],
    allelePools = [["W", "w", "W", "w", "w", "W", "W"], ["W", "T", "t", "W", "w", "W", "w", "Tk", "t", "t"]],
    alleleTargets = [["circle", "circle"], ["circle", "circle", "square", "square"]],
    punnettAlleles = [null, null, null, null],
    punnettOrgs = [null, null, null, null],
    createDragon = function createDragon(alleles, orgArray, orgNumber, initialAlleleString) {
  for (var i = 0, ii = alleles.length; i < ii; i++) {
    if (!alleles[i] || alleles[i] === "circle" || alleles[i] === "square") return;
  }
  var alleleString = initialAlleleString;
  for (i = 0, ii = alleles.length; i < ii; i++) {
    var side = i % 2 ? "b:" : "a:";
    alleleString += side + alleles[i] + (i === ii - 1 ? "" : ",");
  }
  orgArray[orgNumber] = BioLogica.Organism.createLiveOrganism(BioLogica.Species.Drake, alleleString, 1);
},
    moveAllele = function moveAllele(sourceIndex, sourceOrg, targetIndex, targetOrg) {
  var initialAllele = alleleTargets[targetOrg][targetIndex];
  if (initialAllele === "circle" || initialAllele === "square") initialAllele = null;
  alleleTargets[targetOrg][targetIndex] = allelePools[sourceOrg][sourceIndex];
  allelePools[sourceOrg][sourceIndex] = initialAllele;
  createDragon(alleleTargets[targetOrg], dragons, targetOrg, "");
  render();
},
    createPunnettDragons = function createPunnettDragons() {
  var index = 0;
  for (var i = 0; i < 2; i++) {
    for (var j = 2; j < 4; j++) {
      var alleles = [punnettAlleles[i], punnettAlleles[j]];
      createDragon(alleles, punnettOrgs, index++, "a:m,b:M,a:h,b:h,a:C,b:C,a:a,b:a,a:b,b:b,a:D,b:D,a:Fl,b:Fl,a:Hl,b:hl,a:T,b:t,a:rh,b:rh,a:Bog,b:Bog");
    }
  }
},
    placeAlleleInPunnettSquare = function placeAlleleInPunnettSquare(sourceIndex, sourceOrg, targetIndex) {
  var initialAllele = punnettAlleles[targetIndex];
  punnettAlleles[targetIndex] = allelePools[sourceOrg][sourceIndex];
  allelePools[sourceOrg][sourceIndex] = initialAllele;
  createPunnettDragons();
  render();
};

function renderDragon(dragon) {
  if (dragon) {
    return React.createElement(GeniBlocks.OrganismView, { org: dragon });
  } else {
    return React.createElement('div', { className: "unknown" }, "?");
  }
}

function render() {
  var genomes = dragons.map(function (dragon, i) {
    return React.createElement('div', { key: i }, React.createElement('div', { className: "org" }, renderDragon(dragon)), React.createElement('div', { className: "chromosomes labelable" }, React.createElement(GeniBlocks.ChromosomeImageView), React.createElement(GeniBlocks.ChromosomeImageView)), React.createElement('div', { className: "alleles" }, React.createElement(AlleleContainer, {
      org: i,
      pool: allelePools[i],
      targets: alleleTargets[i],
      moveAllele: moveAllele
    })));
  });

  var game = React.createClass({
    displayName: "game",

    render: function render() {
      return React.createElement('div', {}, React.createElement('div', { className: "genomes" }, genomes), React.createElement('div', {}, React.createElement(PunnettContainer, { alleles: punnettAlleles, orgs: punnettOrgs, moveAllele: placeAlleleInPunnettSquare })));
    }
  });

  var draggableGame = DragDropContext(Backend)(game);

  ReactDOM.render(React.createElement(draggableGame), document.getElementById('game'));

  layoutLabels();
}

render();

function layoutLabels() {
  var els = document.getElementsByClassName("labelable");
  for (var i = 0, ii = els.length; i < ii; i++) {
    if (layoutAsLabels) {
      els[i].classList.add("wide");
    } else {
      els[i].classList.remove("wide");
    }
  }
}
document.getElementById("spaces").onclick = function () {
  if (document.getElementById("spaces").checked) {
    layoutAsLabels = false;
    layoutLabels();
  }
};
document.getElementById("labels").onclick = function () {
  if (document.getElementById("labels").checked) {
    layoutAsLabels = true;
    layoutLabels();
  }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV4cGVyaW1lbnRzL2RyYWdnYWJsZS1hbGxlbGVzL2RyYWdnYWJsZS1hbGxlbGVzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSSxrQkFBa0IsU0FBUyxlQUFUO0lBQ2xCLFVBQVUsb0JBQVY7SUFDQSxpQkFBaUIsS0FBakI7SUFFQSxVQUFVLENBQUMsSUFBRCxFQUFPLElBQVAsQ0FBVjtJQUNBLGNBQWMsQ0FBQyxDQUFDLEdBQUQsRUFBTSxHQUFOLEVBQVcsR0FBWCxFQUFnQixHQUFoQixFQUFxQixHQUFyQixFQUEwQixHQUExQixFQUErQixHQUEvQixDQUFELEVBQXNDLENBQUMsR0FBRCxFQUFNLEdBQU4sRUFBVyxHQUFYLEVBQWdCLEdBQWhCLEVBQXFCLEdBQXJCLEVBQTBCLEdBQTFCLEVBQStCLEdBQS9CLEVBQW9DLElBQXBDLEVBQTBDLEdBQTFDLEVBQStDLEdBQS9DLENBQXRDLENBQWQ7SUFDQSxnQkFBZ0IsQ0FBQyxDQUFDLFFBQUQsRUFBVyxRQUFYLENBQUQsRUFBc0IsQ0FBQyxRQUFELEVBQVcsUUFBWCxFQUFxQixRQUFyQixFQUErQixRQUEvQixDQUF0QixDQUFoQjtJQUVBLGlCQUFpQixDQUFDLElBQUQsRUFBTyxJQUFQLEVBQWEsSUFBYixFQUFtQixJQUFuQixDQUFqQjtJQUNBLGNBQWMsQ0FBQyxJQUFELEVBQU8sSUFBUCxFQUFhLElBQWIsRUFBbUIsSUFBbkIsQ0FBZDtJQUVBLGVBQWUsU0FBZixZQUFlLENBQVMsT0FBVCxFQUFrQixRQUFsQixFQUE0QixTQUE1QixFQUF1QyxtQkFBdkMsRUFBNEQ7QUFDekUsT0FBSyxJQUFJLElBQUksQ0FBSixFQUFPLEtBQUssUUFBUSxNQUFSLEVBQWdCLElBQUksRUFBSixFQUFRLEdBQTdDLEVBQWtEO0FBQ2hELFFBQUksQ0FBQyxRQUFRLENBQVIsQ0FBRCxJQUFlLFFBQVEsQ0FBUixNQUFlLFFBQWYsSUFBMkIsUUFBUSxDQUFSLE1BQWUsUUFBZixFQUF5QixPQUF2RTtHQURG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QUssSUFBSSxJQUFFLENBQUYsRUFBSyxLQUFHLElBQUksTUFBSixFQUFZLElBQUksRUFBSixFQUFRLEdBQXJDLEVBQTBDO0FBQ3hDLFFBQUksY0FBSixFQUFvQjtBQUNsQixVQUFJLENBQUosRUFBTyxTQUFQLENBQWlCLEdBQWpCLENBQXFCLE1BQXJCLEVBRGtCO0tBQXBCLE1BRU87QUFDTCxVQUFJLENBQUosRUFBTyxTQUFQLENBQWlCLE1BQWpCLENBQXdCLE1BQXhCLEVBREs7S0FGUDtHQURGO0NBRkY7QUFVQSxTQUFTLGNBQVQsQ0FBd0IsUUFBeEIsRUFBa0MsT0FBbEMsR0FBNEMsWUFBVztBQUNyRCxNQUFJLFNBQVMsY0FBVCxDQUF3QixRQUF4QixFQUFrQyxPQUFsQyxFQUEyQztBQUM3QyxxQkFBaUIsS0FBakIsQ0FENkM7QUFFN0MsbUJBRjZDO0dBQS9DO0NBRDBDO0FBTTVDLFNBQVMsY0FBVCxDQUF3QixRQUF4QixFQUFrQyxPQUFsQyxHQUE0QyxZQUFXO0FBQ3JELE1BQUksU0FBUyxjQUFULENBQXdCLFFBQXhCLEVBQWtDLE9BQWxDLEVBQTJDO0FBQzdDLHFCQUFpQixJQUFqQixDQUQ2QztBQUU3QyxtQkFGNkM7R0FBL0M7Q0FEMEMiLCJmaWxlIjoiZXhwZXJpbWVudHMvZHJhZ2dhYmxlLWFsbGVsZXMvZHJhZ2dhYmxlLWFsbGVsZXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgRHJhZ0Ryb3BDb250ZXh0ID0gUmVhY3REbkQuRHJhZ0Ryb3BDb250ZXh0LFxuICAgIEJhY2tlbmQgPSBSZWFjdERuREhUTUw1QmFja2VuZCxcbiAgICBsYXlvdXRBc0xhYmVscyA9IGZhbHNlLFxuXG4gICAgZHJhZ29ucyA9IFtudWxsLCBudWxsXSxcbiAgICBhbGxlbGVQb29scyA9IFtbXCJXXCIsIFwid1wiLCBcIldcIiwgXCJ3XCIsIFwid1wiLCBcIldcIiwgXCJXXCJdLCBbXCJXXCIsIFwiVFwiLCBcInRcIiwgXCJXXCIsIFwid1wiLCBcIldcIiwgXCJ3XCIsIFwiVGtcIiwgXCJ0XCIsIFwidFwiXV0sXG4gICAgYWxsZWxlVGFyZ2V0cyA9IFtbXCJjaXJjbGVcIiwgXCJjaXJjbGVcIl0sW1wiY2lyY2xlXCIsIFwiY2lyY2xlXCIsIFwic3F1YXJlXCIsIFwic3F1YXJlXCJdXSxcblxuICAgIHB1bm5ldHRBbGxlbGVzID0gW251bGwsIG51bGwsIG51bGwsIG51bGxdLFxuICAgIHB1bm5ldHRPcmdzID0gW251bGwsIG51bGwsIG51bGwsIG51bGxdLFxuXG4gICAgY3JlYXRlRHJhZ29uID0gZnVuY3Rpb24oYWxsZWxlcywgb3JnQXJyYXksIG9yZ051bWJlciwgaW5pdGlhbEFsbGVsZVN0cmluZykge1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gYWxsZWxlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7XG4gICAgICAgIGlmICghYWxsZWxlc1tpXSB8fCBhbGxlbGVzW2ldID09PSBcImNpcmNsZVwiIHx8IGFsbGVsZXNbaV0gPT09IFwic3F1YXJlXCIpIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHZhciBhbGxlbGVTdHJpbmcgPSBpbml0aWFsQWxsZWxlU3RyaW5nO1xuICAgICAgZm9yIChpID0gMCwgaWkgPSBhbGxlbGVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHtcbiAgICAgICAgdmFyIHNpZGUgPSBpICUgMiA/IFwiYjpcIiA6IFwiYTpcIjtcbiAgICAgICAgYWxsZWxlU3RyaW5nICs9IHNpZGUgKyBhbGxlbGVzW2ldICsgKGkgPT09IGlpIC0gMSA/IFwiXCIgOiBcIixcIik7XG4gICAgICB9XG4gICAgICBvcmdBcnJheVtvcmdOdW1iZXJdID0gQmlvTG9naWNhLk9yZ2FuaXNtLmNyZWF0ZUxpdmVPcmdhbmlzbShCaW9Mb2dpY2EuU3BlY2llcy5EcmFrZSwgYWxsZWxlU3RyaW5nLCAxKTtcbiAgICB9LFxuXG4gICAgbW92ZUFsbGVsZSA9IGZ1bmN0aW9uKHNvdXJjZUluZGV4LCBzb3VyY2VPcmcsIHRhcmdldEluZGV4LCB0YXJnZXRPcmcpIHtcbiAgICAgIHZhciBpbml0aWFsQWxsZWxlID0gYWxsZWxlVGFyZ2V0c1t0YXJnZXRPcmddW3RhcmdldEluZGV4XTtcbiAgICAgIGlmICgoaW5pdGlhbEFsbGVsZSA9PT0gXCJjaXJjbGVcIiB8fCBpbml0aWFsQWxsZWxlID09PSBcInNxdWFyZVwiKSkgaW5pdGlhbEFsbGVsZSA9IG51bGw7XG4gICAgICBhbGxlbGVUYXJnZXRzW3RhcmdldE9yZ11bdGFyZ2V0SW5kZXhdID0gYWxsZWxlUG9vbHNbc291cmNlT3JnXVtzb3VyY2VJbmRleF07XG4gICAgICBhbGxlbGVQb29sc1tzb3VyY2VPcmddW3NvdXJjZUluZGV4XSA9IGluaXRpYWxBbGxlbGU7XG4gICAgICBjcmVhdGVEcmFnb24oYWxsZWxlVGFyZ2V0c1t0YXJnZXRPcmddLCBkcmFnb25zLCB0YXJnZXRPcmcsIFwiXCIpO1xuICAgICAgcmVuZGVyKCk7XG4gICAgfSxcblxuICAgIGNyZWF0ZVB1bm5ldHREcmFnb25zID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgaW5kZXggPSAwO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyOyBpKyspIHtcbiAgICAgICAgZm9yICh2YXIgaiA9IDI7IGogPCA0OyBqKyspIHtcbiAgICAgICAgICB2YXIgYWxsZWxlcyA9IFtwdW5uZXR0QWxsZWxlc1tpXSwgcHVubmV0dEFsbGVsZXNbal1dO1xuICAgICAgICAgIGNyZWF0ZURyYWdvbihhbGxlbGVzLCBwdW5uZXR0T3JncywgaW5kZXgrKywgXCJhOm0sYjpNLGE6aCxiOmgsYTpDLGI6QyxhOmEsYjphLGE6YixiOmIsYTpELGI6RCxhOkZsLGI6RmwsYTpIbCxiOmhsLGE6VCxiOnQsYTpyaCxiOnJoLGE6Qm9nLGI6Qm9nXCIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIHBsYWNlQWxsZWxlSW5QdW5uZXR0U3F1YXJlID0gZnVuY3Rpb24oc291cmNlSW5kZXgsIHNvdXJjZU9yZywgdGFyZ2V0SW5kZXgpIHtcbiAgICAgIHZhciBpbml0aWFsQWxsZWxlID0gcHVubmV0dEFsbGVsZXNbdGFyZ2V0SW5kZXhdO1xuICAgICAgcHVubmV0dEFsbGVsZXNbdGFyZ2V0SW5kZXhdID0gYWxsZWxlUG9vbHNbc291cmNlT3JnXVtzb3VyY2VJbmRleF07XG4gICAgICBhbGxlbGVQb29sc1tzb3VyY2VPcmddW3NvdXJjZUluZGV4XSA9IGluaXRpYWxBbGxlbGU7XG4gICAgICBjcmVhdGVQdW5uZXR0RHJhZ29ucygpO1xuICAgICAgcmVuZGVyKCk7XG4gICAgfTtcblxuZnVuY3Rpb24gcmVuZGVyRHJhZ29uKGRyYWdvbikge1xuICBpZiAoZHJhZ29uKSB7XG4gICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoR2VuaUJsb2Nrcy5PcmdhbmlzbVZpZXcsIHtvcmc6IGRyYWdvbn0pO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7Y2xhc3NOYW1lOiBcInVua25vd25cIn0sIFwiP1wiKTtcbiAgfVxufVxuXG5mdW5jdGlvbiByZW5kZXIoKSB7XG4gIHZhciBnZW5vbWVzID0gZHJhZ29ucy5tYXAoZnVuY3Rpb24oZHJhZ29uLCBpKXtcbiAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2Jywge2tleTogaX0sXG4gICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7Y2xhc3NOYW1lOiBcIm9yZ1wifSxcbiAgICAgICAgcmVuZGVyRHJhZ29uKGRyYWdvbilcbiAgICAgICksXG4gICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7Y2xhc3NOYW1lOiBcImNocm9tb3NvbWVzIGxhYmVsYWJsZVwifSxcbiAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChHZW5pQmxvY2tzLkNocm9tb3NvbWVJbWFnZVZpZXcpLFxuICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KEdlbmlCbG9ja3MuQ2hyb21vc29tZUltYWdlVmlldylcbiAgICAgICksXG4gICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7Y2xhc3NOYW1lOiBcImFsbGVsZXNcIn0sXG4gICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQWxsZWxlQ29udGFpbmVyLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIG9yZzogaSxcbiAgICAgICAgICAgIHBvb2w6IGFsbGVsZVBvb2xzW2ldLFxuICAgICAgICAgICAgdGFyZ2V0czogYWxsZWxlVGFyZ2V0c1tpXSxcbiAgICAgICAgICAgIG1vdmVBbGxlbGU6IG1vdmVBbGxlbGVcbiAgICAgICAgICB9XG4gICAgICAgIClcbiAgICAgIClcbiAgICApO1xuICB9KTtcblxuICB2YXIgZ2FtZSA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ2RpdicsIHt9LFxuICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7Y2xhc3NOYW1lOiBcImdlbm9tZXNcIn0sXG4gICAgICAgICAgZ2Vub21lc1xuICAgICAgICApLFxuICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdkaXYnLCB7fSxcbiAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFB1bm5ldHRDb250YWluZXIsIHthbGxlbGVzOiBwdW5uZXR0QWxsZWxlcywgb3JnczogcHVubmV0dE9yZ3MsIG1vdmVBbGxlbGU6IHBsYWNlQWxsZWxlSW5QdW5uZXR0U3F1YXJlfSlcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9XG4gIH0pO1xuXG4gIHZhciBkcmFnZ2FibGVHYW1lID0gRHJhZ0Ryb3BDb250ZXh0KEJhY2tlbmQpKGdhbWUpO1xuXG4gIFJlYWN0RE9NLnJlbmRlcihcbiAgICBSZWFjdC5jcmVhdGVFbGVtZW50KGRyYWdnYWJsZUdhbWUpLFxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lJylcbiAgKTtcblxuICBsYXlvdXRMYWJlbHMoKTtcbn1cblxucmVuZGVyKCk7XG5cbmZ1bmN0aW9uIGxheW91dExhYmVscygpIHtcbiAgdmFyIGVscyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJsYWJlbGFibGVcIik7XG4gIGZvciAodmFyIGk9MCwgaWk9ZWxzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHtcbiAgICBpZiAobGF5b3V0QXNMYWJlbHMpIHtcbiAgICAgIGVsc1tpXS5jbGFzc0xpc3QuYWRkKFwid2lkZVwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZWxzW2ldLmNsYXNzTGlzdC5yZW1vdmUoXCJ3aWRlXCIpO1xuICAgIH1cbiAgfVxufVxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzcGFjZXNcIikub25jbGljayA9IGZ1bmN0aW9uKCkge1xuICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzcGFjZXNcIikuY2hlY2tlZCkge1xuICAgIGxheW91dEFzTGFiZWxzID0gZmFsc2U7XG4gICAgbGF5b3V0TGFiZWxzKCk7XG4gIH1cbn07XG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImxhYmVsc1wiKS5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImxhYmVsc1wiKS5jaGVja2VkKSB7XG4gICAgbGF5b3V0QXNMYWJlbHMgPSB0cnVlO1xuICAgIGxheW91dExhYmVscygpO1xuICB9XG59O1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
